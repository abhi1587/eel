<!DOCTYPE html><head><meta charset="UTF-8"><title>Preconditioning System | Eel</title><link href="../../contrib/materialize/materialize.min.css" type="text/css" rel="stylesheet" media="screen,projection"></link><link href="../../contrib/prism/prism.min.css" type="text/css" rel="stylesheet"></link><link href="../../css/moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/devel_moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/alert_moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/content_moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/sqa_moose.css" type="text/css" rel="stylesheet"></link><link href="../../css/civet_moose.css" type="text/css" rel="stylesheet"></link><link href="../../contrib/katex/katex.min.css" type="text/css" rel="stylesheet"></link><link href="../../css/katex_moose.css" type="text/css" rel="stylesheet"></link><script type="text/javascript" src="../../contrib/jquery/jquery.min.js"></script><script type="text/javascript" src="../../contrib/katex/katex.min.js"></script></head><body><div class="page-wrap"><header><nav><div class="nav-wrapper container"><a href="../../index.html" class="left moose-logo hide-on-med-and-down" id="home-button">Eel</a><a href="https://github.com/hugary1995/eel" class="right"><img src="../../media/framework/github-logo.png" class="github-mark"></img><img src="../../media/framework/github-mark.png" class="github-logo"></img></a><ul class="right hide-on-med-and-down"><li><a href="../../eel.html">Documentation</a></li></ul><a href="#" class="sidenav-trigger" data-target="35a58c04-824c-41cc-8ad8-2feff3272ec1"><i class="material-icons">menu</i></a><ul class="sidenav" id="35a58c04-824c-41cc-8ad8-2feff3272ec1"><li><a href="../../eel.html">Documentation</a></li></ul><a href="#moose-search" class="modal-trigger"><i class="material-icons">search</i></a></div></nav><div class="modal modal-fixed-footer moose-search-modal" id="moose-search"><div class="modal-content container moose-search-modal-content"><div class="row"><div class="col l12"><div class="input-field"><input type_="text" onkeyup="mooseSearch()" placeholder="/index.md" id="moose-search-box"></input></div></div><div><div class="col s12" id="moose-search-results"></div></div></div></div><div class="modal-footer"><a href="#!" class="modal-close btn-flat">Close</a></div></div></header><main class="main"><div class="container"><div class="row"><div class="col hide-on-med-and-down l12"><nav class="breadcrumb-nav"><div class="nav-wrapper"><a href=".." class="breadcrumb">syntax</a><a href="." class="breadcrumb">Preconditioning</a></div></nav></div></div><div class="row"><div class="moose-content col s12 m12 l10"><section id="9688c6ce-7fdf-4feb-aacd-2b9a5dfd26bf" data-section-level="1" data-section-text="Preconditioning System"><h1 id="preconditioning-system">Preconditioning System</h1><section class="scrollspy" id="ec44ee29-2287-4332-b7d5-1848f6935b51" data-section-level="2" data-section-text="Overview"><h2 id="overview">Overview</h2><p>See <a href="../../source/executioners/Steady.html">Steady</a> for more details on how preconditioning is used in solving nonlinear systems in MOOSE. The <code>Preconditioning</code> block allows you to define which type of preconditioning matrix to build and what process to apply. You can define multiple blocks with different names, allowing you to quickly switch out preconditioning options. Within the sub-blocks you can also provide other options specific to that type of preconditioning matrix. You can also override PETSc options here. Only one block can be active at a time.</p></section><section class="scrollspy" id="94777dfa-7cb3-4d4c-b864-a7cb310ef2dd" data-section-level="2" data-section-text="Default Preconditioning Matrix"><h2 id="default-preconditioning-matrix">Default Preconditioning Matrix</h2><p>Consider the fully coupled system of equations:</p><span class="moose-katex-block-equation"><span class="moose-katex-equation table-cell" id="moose-equation-e9c5707c-4eb4-487d-b017-fa5195b9e92a"></span><script>var element = document.getElementById("moose-equation-e9c5707c-4eb4-487d-b017-fa5195b9e92a");katex.render("\\begin{aligned} \\nabla \\cdot k(s,T) \\nabla T  &= 0 \\\\ \\nabla \\cdot D(s,T) \\nabla s  &= 0 , \\end{aligned},", element, {displayMode:true,throwOnError:false,macros:{"\\bs":"\\boldsymbol{#1}","\\grad":"\\bs{\\nabla}","\\divergence":"\\grad \\cdot","\\norm":"\\left\\lVert#1\\right\\rVert","\\abs":"\\left\\lvert#1\\right\\rvert","\\diff":"\\text{ d}#1","\\bfa":"\\boldsymbol{a}","\\bfb":"\\boldsymbol{b}","\\bfc":"\\boldsymbol{c}","\\bfd":"\\boldsymbol{d}","\\bfe":"\\boldsymbol{e}","\\bff":"\\boldsymbol{f}","\\bfg":"\\boldsymbol{g}","\\bfh":"\\boldsymbol{h}","\\bfi":"\\boldsymbol{i}","\\bfj":"\\boldsymbol{j}","\\bfk":"\\boldsymbol{k}","\\bfl":"\\boldsymbol{l}","\\bfm":"\\boldsymbol{m}","\\bfn":"\\boldsymbol{n}","\\bfo":"\\boldsymbol{o}","\\bfp":"\\boldsymbol{p}","\\bfq":"\\boldsymbol{q}","\\bfr":"\\boldsymbol{r}","\\bfs":"\\boldsymbol{s}","\\bft":"\\boldsymbol{t}","\\bfu":"\\boldsymbol{u}","\\bfv":"\\boldsymbol{v}","\\bfw":"\\boldsymbol{w}","\\bfx":"\\boldsymbol{x}","\\bfy":"\\boldsymbol{y}","\\bfz":"\\boldsymbol{z}","\\bfA":"\\boldsymbol{A}","\\bfB":"\\boldsymbol{B}","\\bfC":"\\boldsymbol{C}","\\bfD":"\\boldsymbol{D}","\\bfE":"\\boldsymbol{E}","\\bfF":"\\boldsymbol{F}","\\bfG":"\\boldsymbol{G}","\\bfH":"\\boldsymbol{H}","\\bfI":"\\boldsymbol{I}","\\bfJ":"\\boldsymbol{J}","\\bfK":"\\boldsymbol{K}","\\bfL":"\\boldsymbol{L}","\\bfM":"\\boldsymbol{M}","\\bfN":"\\boldsymbol{N}","\\bfO":"\\boldsymbol{O}","\\bfP":"\\boldsymbol{P}","\\bfQ":"\\boldsymbol{Q}","\\bfR":"\\boldsymbol{R}","\\bfS":"\\boldsymbol{S}","\\bfT":"\\boldsymbol{T}","\\bfU":"\\boldsymbol{U}","\\bfV":"\\boldsymbol{V}","\\bfW":"\\boldsymbol{W}","\\bfX":"\\boldsymbol{X}","\\bfY":"\\boldsymbol{Y}","\\bfZ":"\\boldsymbol{Z}"}});</script></span><p>the fully coupled Jacobian is then approximated using a block-diagonal approach:</p><span class="moose-katex-block-equation"><span class="moose-katex-equation table-cell" id="moose-equation-17cfe32e-9d5a-4336-b294-47d85e67a7ed"></span><script>var element = document.getElementById("moose-equation-17cfe32e-9d5a-4336-b294-47d85e67a7ed");katex.render("\\boldsymbol{R}'(s,T) =  \\begin{bmatrix}    (\\boldsymbol{R}_T)_T & (\\boldsymbol{R}_T)_s    \\\\    (\\boldsymbol{R}_s)_T & (\\boldsymbol{R}_s)_s  \\end{bmatrix}  \\approx  \\begin{bmatrix}    (\\boldsymbol{R}_T)_T & \\boldsymbol{0}    \\\\    \\boldsymbol{0}       & (\\boldsymbol{R}_s)_s  \\end{bmatrix} .", element, {displayMode:true,throwOnError:false,macros:{"\\bs":"\\boldsymbol{#1}","\\grad":"\\bs{\\nabla}","\\divergence":"\\grad \\cdot","\\norm":"\\left\\lVert#1\\right\\rVert","\\abs":"\\left\\lvert#1\\right\\rvert","\\diff":"\\text{ d}#1","\\bfa":"\\boldsymbol{a}","\\bfb":"\\boldsymbol{b}","\\bfc":"\\boldsymbol{c}","\\bfd":"\\boldsymbol{d}","\\bfe":"\\boldsymbol{e}","\\bff":"\\boldsymbol{f}","\\bfg":"\\boldsymbol{g}","\\bfh":"\\boldsymbol{h}","\\bfi":"\\boldsymbol{i}","\\bfj":"\\boldsymbol{j}","\\bfk":"\\boldsymbol{k}","\\bfl":"\\boldsymbol{l}","\\bfm":"\\boldsymbol{m}","\\bfn":"\\boldsymbol{n}","\\bfo":"\\boldsymbol{o}","\\bfp":"\\boldsymbol{p}","\\bfq":"\\boldsymbol{q}","\\bfr":"\\boldsymbol{r}","\\bfs":"\\boldsymbol{s}","\\bft":"\\boldsymbol{t}","\\bfu":"\\boldsymbol{u}","\\bfv":"\\boldsymbol{v}","\\bfw":"\\boldsymbol{w}","\\bfx":"\\boldsymbol{x}","\\bfy":"\\boldsymbol{y}","\\bfz":"\\boldsymbol{z}","\\bfA":"\\boldsymbol{A}","\\bfB":"\\boldsymbol{B}","\\bfC":"\\boldsymbol{C}","\\bfD":"\\boldsymbol{D}","\\bfE":"\\boldsymbol{E}","\\bfF":"\\boldsymbol{F}","\\bfG":"\\boldsymbol{G}","\\bfH":"\\boldsymbol{H}","\\bfI":"\\boldsymbol{I}","\\bfJ":"\\boldsymbol{J}","\\bfK":"\\boldsymbol{K}","\\bfL":"\\boldsymbol{L}","\\bfM":"\\boldsymbol{M}","\\bfN":"\\boldsymbol{N}","\\bfO":"\\boldsymbol{O}","\\bfP":"\\boldsymbol{P}","\\bfQ":"\\boldsymbol{Q}","\\bfR":"\\boldsymbol{R}","\\bfS":"\\boldsymbol{S}","\\bfT":"\\boldsymbol{T}","\\bfU":"\\boldsymbol{U}","\\bfV":"\\boldsymbol{V}","\\bfW":"\\boldsymbol{W}","\\bfX":"\\boldsymbol{X}","\\bfY":"\\boldsymbol{Y}","\\bfZ":"\\boldsymbol{Z}"}});</script></span><p>Thus, for this example, the default preconditioning matrix is defined as:</p><span class="moose-katex-block-equation"><span class="moose-katex-equation table-cell" id="moose-equation-aba67300-f556-4de8-bd7e-9008783eab91"></span><script>var element = document.getElementById("moose-equation-aba67300-f556-4de8-bd7e-9008783eab91");katex.render("\\boldsymbol{M} \\equiv     \\begin{bmatrix}       (k(s,T) \\nabla \\phi_j, \\nabla \\psi_i) & \\boldsymbol{0} \\\\       \\boldsymbol{0} & (D(s,T) \\nabla \\phi_j, \\nabla\\psi_i)     \\end{bmatrix} \\approx \\boldsymbol{R}'(s,T) .", element, {displayMode:true,throwOnError:false,macros:{"\\bs":"\\boldsymbol{#1}","\\grad":"\\bs{\\nabla}","\\divergence":"\\grad \\cdot","\\norm":"\\left\\lVert#1\\right\\rVert","\\abs":"\\left\\lvert#1\\right\\rvert","\\diff":"\\text{ d}#1","\\bfa":"\\boldsymbol{a}","\\bfb":"\\boldsymbol{b}","\\bfc":"\\boldsymbol{c}","\\bfd":"\\boldsymbol{d}","\\bfe":"\\boldsymbol{e}","\\bff":"\\boldsymbol{f}","\\bfg":"\\boldsymbol{g}","\\bfh":"\\boldsymbol{h}","\\bfi":"\\boldsymbol{i}","\\bfj":"\\boldsymbol{j}","\\bfk":"\\boldsymbol{k}","\\bfl":"\\boldsymbol{l}","\\bfm":"\\boldsymbol{m}","\\bfn":"\\boldsymbol{n}","\\bfo":"\\boldsymbol{o}","\\bfp":"\\boldsymbol{p}","\\bfq":"\\boldsymbol{q}","\\bfr":"\\boldsymbol{r}","\\bfs":"\\boldsymbol{s}","\\bft":"\\boldsymbol{t}","\\bfu":"\\boldsymbol{u}","\\bfv":"\\boldsymbol{v}","\\bfw":"\\boldsymbol{w}","\\bfx":"\\boldsymbol{x}","\\bfy":"\\boldsymbol{y}","\\bfz":"\\boldsymbol{z}","\\bfA":"\\boldsymbol{A}","\\bfB":"\\boldsymbol{B}","\\bfC":"\\boldsymbol{C}","\\bfD":"\\boldsymbol{D}","\\bfE":"\\boldsymbol{E}","\\bfF":"\\boldsymbol{F}","\\bfG":"\\boldsymbol{G}","\\bfH":"\\boldsymbol{H}","\\bfI":"\\boldsymbol{I}","\\bfJ":"\\boldsymbol{J}","\\bfK":"\\boldsymbol{K}","\\bfL":"\\boldsymbol{L}","\\bfM":"\\boldsymbol{M}","\\bfN":"\\boldsymbol{N}","\\bfO":"\\boldsymbol{O}","\\bfP":"\\boldsymbol{P}","\\bfQ":"\\boldsymbol{Q}","\\bfR":"\\boldsymbol{R}","\\bfS":"\\boldsymbol{S}","\\bfT":"\\boldsymbol{T}","\\bfU":"\\boldsymbol{U}","\\bfV":"\\boldsymbol{V}","\\bfW":"\\boldsymbol{W}","\\bfX":"\\boldsymbol{X}","\\bfY":"\\boldsymbol{Y}","\\bfZ":"\\boldsymbol{Z}"}});</script></span></section><section class="scrollspy" id="74101113-1ad6-4757-bd2d-a34f82f4e5f8" data-section-level="2" data-section-text="Example Input File Syntax"><h2 id="example-input-file-syntax">Example Input File Syntax</h2><p>A single preconditioner may be specified as below:</p><pre class="moose-pre" style="max-height:350px;"><code class="language-None">[Preconditioning]
  [my_prec]
    type = SMP
    # SMP Options Go Here!
    # Override PETSc Options Here!
  []
[]
</code></pre><p>Nested preconditioners may be specified as below, for the <a href="../../source/preconditioners/FieldSplitPreconditioner.html">FSP</a> for example:</p><pre class="moose-pre" style="max-height:350px;"><code class="language-text">[Preconditioning]
  active = &#x27;FSP&#x27;

  [./FSP]
    type = FSP
    # It is the starting point of splitting
    topsplit = &#x27;uv&#x27; # &#x27;uv&#x27; should match the following block name
    [./uv]
      splitting = &#x27;u v&#x27; # &#x27;u&#x27; and &#x27;v&#x27; are the names of subsolvers
      # Generally speaking, there are four types of splitting we could choose
      # &lt;additive,multiplicative,symmetric_multiplicative,schur&gt;
      splitting_type = additive
      # An approximate solution to the original system
      # | A_uu  A_uv | | u | _ |f_u|
      # |  0    A_vv | | v | - |f_v|
      #  is obtained by solving the following subsystems
      #  A_uu u = f_u and A_vv v = f_v
      # If splitting type is specified as schur, we may also want to set more options to
      # control how schur works using PETSc options
      # petsc_options_iname = &#x27;-pc_fieldsplit_schur_fact_type -pc_fieldsplit_schur_precondition&#x27;
      # petsc_options_value = &#x27;full selfp&#x27;
    [../]
    [./u]
      vars = &#x27;u&#x27;
      # PETSc options for this subsolver
      # A prefix will be applied, so just put the options for this subsolver only
      petsc_options_iname = &#x27;-pc_type -ksp_type&#x27;
      petsc_options_value = &#x27;     hypre preonly&#x27;
    [../]
    [./v]
      vars = &#x27;v&#x27;
      # PETSc options for this subsolver
      petsc_options_iname = &#x27;-pc_type -ksp_type&#x27;
      petsc_options_value = &#x27;     hypre  preonly&#x27;
    [../]
  [../]
[]
</code></pre><a class="moose-source-filename tooltipped modal-trigger" href="#261c48c3-a3a8-4234-8280-f061d81e39ca">(moose/test/tests/preconditioners/fsp/fsp_test.i)</a></section><section class="scrollspy" id="ff9e1503-90cf-4c50-90a7-bfe58be071c9" data-section-level="2" data-section-text="Available Objects"><h2 id="available-objects">Available Objects</h2><ul class="moose-syntax-list collection with-header"><li class="collection-header">Moose App</li><li class="collection-item"><a href="../../source/splits/Split.html">Split</a>Field split based preconditioner for nonlinear solver.</li><li class="collection-item"><a href="../../source/preconditioners/FiniteDifferencePreconditioner.html">FDP</a>Finite difference preconditioner (FDP) builds a numerical Jacobian for preconditioning, only use for testing and verification.</li><li class="collection-item"><a href="../../source/preconditioners/FieldSplitPreconditioner.html">FSP</a>Preconditioner designed to map onto PETSc&#x27;s PCFieldSplit.</li><li class="collection-item"><a href="../../source/preconditioners/PhysicsBasedPreconditioner.html">PBP</a>Physics-based preconditioner (PBP) allows individual physics to have their own preconditioner.</li><li class="collection-item"><a href="../../source/preconditioners/SingleMatrixPreconditioner.html">SMP</a>Single matrix preconditioner (SMP) builds a preconditioner using user defined off-diagonal parts of the Jacobian.</li><li class="collection-item"><a href="../../source/preconditioners/VariableCondensationPreconditioner.html">VCP</a>Varialble condensation preconditioner (VCP) condenses out specified variable(s) from the Jacobian matrix and produces a system of equations with less unkowns to be solved by the underlying preconditioners.</li></ul></section><section class="scrollspy" id="e654ca7b-4421-4cdc-9a9a-93bcc0044941" data-section-level="2" data-section-text="Available Actions"><h2 id="available-actions">Available Actions</h2><ul class="moose-syntax-list collection with-header"><li class="collection-header">Moose App</li><li class="collection-item"><a href="../../source/actions/SetupPreconditionerAction.html">SetupPreconditionerAction</a>Add a Preconditioner object to the simulation.</li><li class="collection-item"><a href="../../source/actions/AddFieldSplitAction.html">AddFieldSplitAction</a>Add a Split object to the simulation.</li></ul></section></section><div class="moose-modal modal" id="261c48c3-a3a8-4234-8280-f061d81e39ca"><div class="modal-content"><h4>(moose/test/tests/preconditioners/fsp/fsp_test.i)</h4><pre class="moose-pre"><code class="language-text">[Mesh]
  [./square]
    type = GeneratedMeshGenerator
    nx = 2
    ny = 2
    dim = 2
  [../]
[]

[Variables]
  active = &#x27;u v&#x27;

  [./u]
    order = FIRST
    family = LAGRANGE
  [../]

  [./v]
    order = FIRST
    family = LAGRANGE
  [../]
[]

[Kernels]
  active = &#x27;diff_u conv_v diff_v&#x27;

  [./diff_u]
    type = Diffusion
    variable = u
  [../]

  [./conv_v]
    type = CoupledForce
    variable = v
    v = u
  [../]

  [./diff_v]
    type = Diffusion
    variable = v
  [../]
[]

[BCs]
  active = &#x27;left_u right_u left_v&#x27;

  [./left_u]
    type = DirichletBC
    variable = u
    boundary = 3
    value = 0
  [../]

  [./right_u]
    type = DirichletBC
    variable = u
    boundary = 1
    value = 100
  [../]

  [./left_v]
    type = DirichletBC
    variable = v
    boundary = 3
    value = 0
  [../]

  [./right_v]
    type = DirichletBC
    variable = v
    boundary = 1
    value = 0
  [../]
[]

[Executioner]
  type = Steady

  # This is setup automatically in MOOSE (SetupPBPAction.C)
  # petsc_options = &#x27;-snes_mf_operator&#x27;
  # petsc_options_iname = &#x27;-pc_type&#x27;
  # petsc_options_value =  &#x27;asm&#x27;
[]

[Preconditioning]
  active = &#x27;FSP&#x27;

  [./FSP]
    type = FSP
    # It is the starting point of splitting
    topsplit = &#x27;uv&#x27; # &#x27;uv&#x27; should match the following block name
    [./uv]
      splitting = &#x27;u v&#x27; # &#x27;u&#x27; and &#x27;v&#x27; are the names of subsolvers
      # Generally speaking, there are four types of splitting we could choose
      # &lt;additive,multiplicative,symmetric_multiplicative,schur&gt;
      splitting_type  = additive
      # An approximate solution to the original system
      # | A_uu  A_uv | | u | _ |f_u|
      # |  0    A_vv | | v | - |f_v|
      #  is obtained by solving the following subsystems
      #  A_uu u = f_u and A_vv v = f_v
      # If splitting type is specified as schur, we may also want to set more options to
      # control how schur works using PETSc options
      # petsc_options_iname = &#x27;-pc_fieldsplit_schur_fact_type -pc_fieldsplit_schur_precondition&#x27;
      # petsc_options_value = &#x27;full selfp&#x27;
    [../]
    [./u]
      vars = &#x27;u&#x27;
      # PETSc options for this subsolver
      # A prefix will be applied, so just put the options for this subsolver only
      petsc_options_iname = &#x27;-pc_type -ksp_type&#x27;
      petsc_options_value = &#x27;     hypre preonly&#x27;
    [../]
    [./v]
      vars = &#x27;v&#x27;
      # PETSc options for this subsolver
      petsc_options_iname = &#x27;-pc_type -ksp_type&#x27;
      petsc_options_value = &#x27;     hypre  preonly&#x27;
    [../]
  [../]
[]

[Outputs]
  file_base = out
  exodus = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div></div><div class="col hide-on-med-and-down l2"><div class="toc-wrapper pin-top"><ul class="section table-of-contents"><li><a href="#ec44ee29-2287-4332-b7d5-1848f6935b51" class="tooltipped" data-position="left" data-tooltip="Overview">Overview</a></li><li><a href="#94777dfa-7cb3-4d4c-b864-a7cb310ef2dd" class="tooltipped" data-position="left" data-tooltip="Default Preconditioning Matrix">Default Preconditioning Matrix</a></li><li><a href="#74101113-1ad6-4757-bd2d-a34f82f4e5f8" class="tooltipped" data-position="left" data-tooltip="Example Input File Syntax">Example Input File Syntax</a></li><li><a href="#ff9e1503-90cf-4c50-90a7-bfe58be071c9" class="tooltipped" data-position="left" data-tooltip="Available Objects">Available Objects</a></li><li><a href="#e654ca7b-4421-4cdc-9a9a-93bcc0044941" class="tooltipped" data-position="left" data-tooltip="Available Actions">Available Actions</a></li></ul></div></div></div></div></main></div></body><script type="text/javascript" src="../../contrib/materialize/materialize.min.js"></script><script type="text/javascript" src="../../contrib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="../../contrib/prism/prism.min.js"></script><script type="text/javascript" src="../../js/init.js"></script><script type="text/javascript" src="../../js/navigation.js"></script><script type="text/javascript" src="../../contrib/fuse/fuse.min.js"></script><script type="text/javascript" src="../../js/search_index.js"></script><script type="text/javascript" src="../../js/sqa_moose.js"></script>